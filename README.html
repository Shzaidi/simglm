<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Regression simulation function</title>

<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 12px;
   margin: 8px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 { 
   font-size:2.2em; 
}

h2 { 
   font-size:1.8em; 
}

h3 { 
   font-size:1.4em; 
}

h4 { 
   font-size:1.0em; 
}

h5 { 
   font-size:0.9em; 
}

h6 { 
   font-size:0.8em; 
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre {	
   margin-top: 0;
   max-width: 95%;
   border: 1px solid #ccc;
   white-space: pre-wrap;
}

pre code {
   display: block; padding: 0.5em;
}

code.r, code.cpp {
   background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * { 
      background: transparent !important; 
      color: black !important; 
      filter:none !important; 
      -ms-filter: none !important; 
   }

   body { 
      font-size:12pt; 
      max-width:100%; 
   }
       
   a, a:visited { 
      text-decoration: underline; 
   }

   hr { 
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote { 
      padding-right: 1em; 
      page-break-inside: avoid; 
   }

   tr, img { 
      page-break-inside: avoid; 
   }

   img { 
      max-width: 100% !important; 
   }

   @page :left { 
      margin: 15mm 20mm 15mm 10mm; 
   }
     
   @page :right { 
      margin: 15mm 10mm 15mm 20mm; 
   }

   p, h2, h3 { 
      orphans: 3; widows: 3; 
   }

   h2, h3 { 
      page-break-after: avoid; 
   }
}

</style>

<!-- Styles for R syntax highlighter -->
<style type="text/css">
   pre .operator,
   pre .paren {
     color: rgb(104, 118, 135)
   }

   pre .literal {
     color: rgb(88, 72, 246)
   }

   pre .number {
     color: rgb(0, 0, 205);
   }

   pre .comment {
     color: rgb(76, 136, 107);
   }

   pre .keyword {
     color: rgb(0, 0, 255);
   }

   pre .identifier {
     color: rgb(0, 0, 0);
   }

   pre .string {
     color: rgb(3, 106, 7);
   }
</style>

<!-- R syntax highlighter -->
<script type="text/javascript">
var hljs=new function(){function m(p){return p.replace(/&/gm,"&amp;").replace(/</gm,"&lt;")}function f(r,q,p){return RegExp(q,"m"+(r.cI?"i":"")+(p?"g":""))}function b(r){for(var p=0;p<r.childNodes.length;p++){var q=r.childNodes[p];if(q.nodeName=="CODE"){return q}if(!(q.nodeType==3&&q.nodeValue.match(/\s+/))){break}}}function h(t,s){var p="";for(var r=0;r<t.childNodes.length;r++){if(t.childNodes[r].nodeType==3){var q=t.childNodes[r].nodeValue;if(s){q=q.replace(/\n/g,"")}p+=q}else{if(t.childNodes[r].nodeName=="BR"){p+="\n"}else{p+=h(t.childNodes[r])}}}if(/MSIE [678]/.test(navigator.userAgent)){p=p.replace(/\r/g,"\n")}return p}function a(s){var r=s.className.split(/\s+/);r=r.concat(s.parentNode.className.split(/\s+/));for(var q=0;q<r.length;q++){var p=r[q].replace(/^language-/,"");if(e[p]){return p}}}function c(q){var p=[];(function(s,t){for(var r=0;r<s.childNodes.length;r++){if(s.childNodes[r].nodeType==3){t+=s.childNodes[r].nodeValue.length}else{if(s.childNodes[r].nodeName=="BR"){t+=1}else{if(s.childNodes[r].nodeType==1){p.push({event:"start",offset:t,node:s.childNodes[r]});t=arguments.callee(s.childNodes[r],t);p.push({event:"stop",offset:t,node:s.childNodes[r]})}}}}return t})(q,0);return p}function k(y,w,x){var q=0;var z="";var s=[];function u(){if(y.length&&w.length){if(y[0].offset!=w[0].offset){return(y[0].offset<w[0].offset)?y:w}else{return w[0].event=="start"?y:w}}else{return y.length?y:w}}function t(D){var A="<"+D.nodeName.toLowerCase();for(var B=0;B<D.attributes.length;B++){var C=D.attributes[B];A+=" "+C.nodeName.toLowerCase();if(C.value!==undefined&&C.value!==false&&C.value!==null){A+='="'+m(C.value)+'"'}}return A+">"}while(y.length||w.length){var v=u().splice(0,1)[0];z+=m(x.substr(q,v.offset-q));q=v.offset;if(v.event=="start"){z+=t(v.node);s.push(v.node)}else{if(v.event=="stop"){var p,r=s.length;do{r--;p=s[r];z+=("</"+p.nodeName.toLowerCase()+">")}while(p!=v.node);s.splice(r,1);while(r<s.length){z+=t(s[r]);r++}}}}return z+m(x.substr(q))}function j(){function q(x,y,v){if(x.compiled){return}var u;var s=[];if(x.k){x.lR=f(y,x.l||hljs.IR,true);for(var w in x.k){if(!x.k.hasOwnProperty(w)){continue}if(x.k[w] instanceof Object){u=x.k[w]}else{u=x.k;w="keyword"}for(var r in u){if(!u.hasOwnProperty(r)){continue}x.k[r]=[w,u[r]];s.push(r)}}}if(!v){if(x.bWK){x.b="\\b("+s.join("|")+")\\s"}x.bR=f(y,x.b?x.b:"\\B|\\b");if(!x.e&&!x.eW){x.e="\\B|\\b"}if(x.e){x.eR=f(y,x.e)}}if(x.i){x.iR=f(y,x.i)}if(x.r===undefined){x.r=1}if(!x.c){x.c=[]}x.compiled=true;for(var t=0;t<x.c.length;t++){if(x.c[t]=="self"){x.c[t]=x}q(x.c[t],y,false)}if(x.starts){q(x.starts,y,false)}}for(var p in e){if(!e.hasOwnProperty(p)){continue}q(e[p].dM,e[p],true)}}function d(B,C){if(!j.called){j();j.called=true}function q(r,M){for(var L=0;L<M.c.length;L++){if((M.c[L].bR.exec(r)||[null])[0]==r){return M.c[L]}}}function v(L,r){if(D[L].e&&D[L].eR.test(r)){return 1}if(D[L].eW){var M=v(L-1,r);return M?M+1:0}return 0}function w(r,L){return L.i&&L.iR.test(r)}function K(N,O){var M=[];for(var L=0;L<N.c.length;L++){M.push(N.c[L].b)}var r=D.length-1;do{if(D[r].e){M.push(D[r].e)}r--}while(D[r+1].eW);if(N.i){M.push(N.i)}return f(O,M.join("|"),true)}function p(M,L){var N=D[D.length-1];if(!N.t){N.t=K(N,E)}N.t.lastIndex=L;var r=N.t.exec(M);return r?[M.substr(L,r.index-L),r[0],false]:[M.substr(L),"",true]}function z(N,r){var L=E.cI?r[0].toLowerCase():r[0];var M=N.k[L];if(M&&M instanceof Array){return M}return false}function F(L,P){L=m(L);if(!P.k){return L}var r="";var O=0;P.lR.lastIndex=0;var M=P.lR.exec(L);while(M){r+=L.substr(O,M.index-O);var N=z(P,M);if(N){x+=N[1];r+='<span class="'+N[0]+'">'+M[0]+"</span>"}else{r+=M[0]}O=P.lR.lastIndex;M=P.lR.exec(L)}return r+L.substr(O,L.length-O)}function J(L,M){if(M.sL&&e[M.sL]){var r=d(M.sL,L);x+=r.keyword_count;return r.value}else{return F(L,M)}}function I(M,r){var L=M.cN?'<span class="'+M.cN+'">':"";if(M.rB){y+=L;M.buffer=""}else{if(M.eB){y+=m(r)+L;M.buffer=""}else{y+=L;M.buffer=r}}D.push(M);A+=M.r}function G(N,M,Q){var R=D[D.length-1];if(Q){y+=J(R.buffer+N,R);return false}var P=q(M,R);if(P){y+=J(R.buffer+N,R);I(P,M);return P.rB}var L=v(D.length-1,M);if(L){var O=R.cN?"</span>":"";if(R.rE){y+=J(R.buffer+N,R)+O}else{if(R.eE){y+=J(R.buffer+N,R)+O+m(M)}else{y+=J(R.buffer+N+M,R)+O}}while(L>1){O=D[D.length-2].cN?"</span>":"";y+=O;L--;D.length--}var r=D[D.length-1];D.length--;D[D.length-1].buffer="";if(r.starts){I(r.starts,"")}return R.rE}if(w(M,R)){throw"Illegal"}}var E=e[B];var D=[E.dM];var A=0;var x=0;var y="";try{var s,u=0;E.dM.buffer="";do{s=p(C,u);var t=G(s[0],s[1],s[2]);u+=s[0].length;if(!t){u+=s[1].length}}while(!s[2]);if(D.length>1){throw"Illegal"}return{r:A,keyword_count:x,value:y}}catch(H){if(H=="Illegal"){return{r:0,keyword_count:0,value:m(C)}}else{throw H}}}function g(t){var p={keyword_count:0,r:0,value:m(t)};var r=p;for(var q in e){if(!e.hasOwnProperty(q)){continue}var s=d(q,t);s.language=q;if(s.keyword_count+s.r>r.keyword_count+r.r){r=s}if(s.keyword_count+s.r>p.keyword_count+p.r){r=p;p=s}}if(r.language){p.second_best=r}return p}function i(r,q,p){if(q){r=r.replace(/^((<[^>]+>|\t)+)/gm,function(t,w,v,u){return w.replace(/\t/g,q)})}if(p){r=r.replace(/\n/g,"<br>")}return r}function n(t,w,r){var x=h(t,r);var v=a(t);var y,s;if(v){y=d(v,x)}else{return}var q=c(t);if(q.length){s=document.createElement("pre");s.innerHTML=y.value;y.value=k(q,c(s),x)}y.value=i(y.value,w,r);var u=t.className;if(!u.match("(\\s|^)(language-)?"+v+"(\\s|$)")){u=u?(u+" "+v):v}if(/MSIE [678]/.test(navigator.userAgent)&&t.tagName=="CODE"&&t.parentNode.tagName=="PRE"){s=t.parentNode;var p=document.createElement("div");p.innerHTML="<pre><code>"+y.value+"</code></pre>";t=p.firstChild.firstChild;p.firstChild.cN=s.cN;s.parentNode.replaceChild(p.firstChild,s)}else{t.innerHTML=y.value}t.className=u;t.result={language:v,kw:y.keyword_count,re:y.r};if(y.second_best){t.second_best={language:y.second_best.language,kw:y.second_best.keyword_count,re:y.second_best.r}}}function o(){if(o.called){return}o.called=true;var r=document.getElementsByTagName("pre");for(var p=0;p<r.length;p++){var q=b(r[p]);if(q){n(q,hljs.tabReplace)}}}function l(){if(window.addEventListener){window.addEventListener("DOMContentLoaded",o,false);window.addEventListener("load",o,false)}else{if(window.attachEvent){window.attachEvent("onload",o)}else{window.onload=o}}}var e={};this.LANGUAGES=e;this.highlight=d;this.highlightAuto=g;this.fixMarkup=i;this.highlightBlock=n;this.initHighlighting=o;this.initHighlightingOnLoad=l;this.IR="[a-zA-Z][a-zA-Z0-9_]*";this.UIR="[a-zA-Z_][a-zA-Z0-9_]*";this.NR="\\b\\d+(\\.\\d+)?";this.CNR="\\b(0[xX][a-fA-F0-9]+|(\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)";this.BNR="\\b(0b[01]+)";this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~";this.ER="(?![\\s\\S])";this.BE={b:"\\\\.",r:0};this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0};this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0};this.CLCM={cN:"comment",b:"//",e:"$"};this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"};this.HCM={cN:"comment",b:"#",e:"$"};this.NM={cN:"number",b:this.NR,r:0};this.CNM={cN:"number",b:this.CNR,r:0};this.BNM={cN:"number",b:this.BNR,r:0};this.inherit=function(r,s){var p={};for(var q in r){p[q]=r[q]}if(s){for(var q in s){p[q]=s[q]}}return p}}();hljs.LANGUAGES.cpp=function(){var a={keyword:{"false":1,"int":1,"float":1,"while":1,"private":1,"char":1,"catch":1,"export":1,virtual:1,operator:2,sizeof:2,dynamic_cast:2,typedef:2,const_cast:2,"const":1,struct:1,"for":1,static_cast:2,union:1,namespace:1,unsigned:1,"long":1,"throw":1,"volatile":2,"static":1,"protected":1,bool:1,template:1,mutable:1,"if":1,"public":1,friend:2,"do":1,"return":1,"goto":1,auto:1,"void":2,"enum":1,"else":1,"break":1,"new":1,extern:1,using:1,"true":1,"class":1,asm:1,"case":1,typeid:1,"short":1,reinterpret_cast:2,"default":1,"double":1,register:1,explicit:1,signed:1,typename:1,"try":1,"this":1,"switch":1,"continue":1,wchar_t:1,inline:1,"delete":1,alignof:1,char16_t:1,char32_t:1,constexpr:1,decltype:1,noexcept:1,nullptr:1,static_assert:1,thread_local:1,restrict:1,_Bool:1,complex:1},built_in:{std:1,string:1,cin:1,cout:1,cerr:1,clog:1,stringstream:1,istringstream:1,ostringstream:1,auto_ptr:1,deque:1,list:1,queue:1,stack:1,vector:1,map:1,set:1,bitset:1,multiset:1,multimap:1,unordered_set:1,unordered_map:1,unordered_multiset:1,unordered_multimap:1,array:1,shared_ptr:1}};return{dM:{k:a,i:"</",c:[hljs.CLCM,hljs.CBLCLM,hljs.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},hljs.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:a,r:10,c:["self"]}]}}}();hljs.LANGUAGES.r={dM:{c:[hljs.HCM,{cN:"number",b:"\\b0[xX][0-9a-fA-F]+[Li]?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+(?:[eE][+\\-]?\\d*)?L\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\b\\d+\\.(?!\\d)(?:i\\b)?",e:hljs.IMMEDIATE_RE,r:1},{cN:"number",b:"\\b\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"keyword",b:"(?:tryCatch|library|setGeneric|setGroupGeneric)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\.",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\.\\.\\d+(?![\\w.])",e:hljs.IMMEDIATE_RE,r:10},{cN:"keyword",b:"\\b(?:function)",e:hljs.IMMEDIATE_RE,r:2},{cN:"keyword",b:"(?:if|in|break|next|repeat|else|for|return|switch|while|try|stop|warning|require|attach|detach|source|setMethod|setClass)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"literal",b:"(?:NA|NA_integer_|NA_real_|NA_character_|NA_complex_)\\b",e:hljs.IMMEDIATE_RE,r:10},{cN:"literal",b:"(?:NULL|TRUE|FALSE|T|F|Inf|NaN)\\b",e:hljs.IMMEDIATE_RE,r:1},{cN:"identifier",b:"[a-zA-Z.][a-zA-Z0-9._]*\\b",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"<\\-(?!\\s*\\d)",e:hljs.IMMEDIATE_RE,r:2},{cN:"operator",b:"\\->|<\\-",e:hljs.IMMEDIATE_RE,r:1},{cN:"operator",b:"%%|~",e:hljs.IMMEDIATE_RE},{cN:"operator",b:">=|<=|==|!=|\\|\\||&&|=|\\+|\\-|\\*|/|\\^|>|<|!|&|\\||\\$|:",e:hljs.IMMEDIATE_RE,r:0},{cN:"operator",b:"%",e:"%",i:"\\n",r:1},{cN:"identifier",b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[hljs.BE],r:0},{cN:"string",b:"'",e:"'",c:[hljs.BE],r:0},{cN:"paren",b:"[[({\\])}]",e:hljs.IMMEDIATE_RE,r:0}]}};
hljs.initHighlightingOnLoad();
</script>




</head>

<body>
<h1>Regression simulation function</h1>

<p>A flexible suite of functions to simulate nested data.<br/>
Currently supports the following featurs:</p>

<ul>
<li>Longitudinal data simulation</li>
<li>Two levels of nesting</li>
<li>Specification of distribution of random effects</li>
<li>Specification of distribution of within cluster errors</li>
<li>Specification of serial correlation</li>
<li>Specification of population parameters
*Including both fixed and random effects</li>
<li>Specification of the number of variables

<ul>
<li>Ability to add time-varying covariates</li>
<li>Specify the mean and variance of fixed covariate variables</li>
</ul></li>
<li>Generation of mixture normal distributions

<ul>
<li>Ability to compute variance of each normal distribution in each mixture distribution
based on equal weighting.</li>
</ul></li>
<li>Cross sectional data simulation</li>
<li>Single level simulation</li>
</ul>

<p>Features coming soon:</p>

<ul>
<li>Adding factor variable simulation</li>
<li>More options for simulating random components

<ul>
<li>More distributions</li>
<li>Ability to simulate different distributions for different random effects</li>
</ul></li>
<li>Power by simulation</li>
<li>Missing Data</li>
<li>Ability to specify correlation amount random effects individually.</li>
<li>Expand variance of mixture distribution function to include unequal weighting.</li>
</ul>

<h1>Single level simulation example</h1>

<p>Simulating a single level regression model with sim.reg.single, mean centered variables.  This function outputs the entire design matrix, the error, the cross product, simulated data, and the ID variable.</p>

<pre><code class="r">library(simReg)
fixed &lt;- ~1 + act + diff + numCourse + act:numCourse
fixed.param &lt;- c(2, 4, 1, 3.5, 2)
cov.param &lt;- list(c(0, 4), c(0, 3), c(0, 3))
n &lt;- 150
errorVar &lt;- 3
err.dist &lt;- &quot;norm&quot;
head(temp.single &lt;- sim.reg.single(fixed, fixed.param, cov.param, n, errorVar, 
    err.dist), n = 15)
</code></pre>

<pre><code>## Loading required package: MASS
</code></pre>

<pre><code>## Loading required package: Matrix
</code></pre>

<pre><code>## Loading required package: lattice
</code></pre>

<pre><code>## Loading required package: VGAM
</code></pre>

<pre><code>## Loading required package: splines
</code></pre>

<pre><code>## Loading required package: stats4
</code></pre>

<pre><code>## Attaching package: &#39;VGAM&#39;
</code></pre>

<pre><code>## The following object(s) are masked from &#39;package:stats4&#39;:
## 
## coef
</code></pre>

<pre><code>## The following object(s) are masked from &#39;package:splines&#39;:
## 
## bs, ns
</code></pre>

<pre><code>## The following object(s) are masked from &#39;package:MASS&#39;:
## 
## huber
</code></pre>

<pre><code>## The following object(s) are masked from &#39;package:stats&#39;:
## 
## case.names, coef, coefficients, df.residual, dfbeta, fitted,
## fitted.values, formula, hatvalues, poly, residuals, variable.names,
## weights
</code></pre>

<pre><code>## The following object(s) are masked from &#39;package:base&#39;:
## 
## identity, scale.default
</code></pre>

<pre><code>##    X.Intercept.     act     diff numCourse act.numCourse       err
## 1             1  5.3444  3.90083    2.4892       13.3036 -0.580919
## 2             1 -8.1790  2.67998    7.5361      -61.6380  0.746102
## 3             1  3.6463 -2.44367   -0.9301       -3.3912  1.020639
## 4             1  3.2350 -0.62607   -3.0351       -9.8185  0.398262
## 5             1  0.7027 -4.89700   -5.6656       -3.9815 -1.170920
## 6             1  2.4473  1.97311    1.5314        3.7478  1.300338
## 7             1 -2.6162  3.43108    2.3388       -6.1186  1.891424
## 8             1 -0.5873  0.58534    0.6874       -0.4037 -1.064216
## 9             1  4.5259  2.00282    1.1739        5.3130  1.718377
## 10            1  2.2355 -0.51901   -2.4306       -5.4336 -1.419187
## 11            1 -2.4112  3.00473   -4.3090       10.3899 -0.005415
## 12            1  4.1668 -0.09871    2.4580       10.2420 -1.952720
## 13            1  0.7726 -0.62150    0.5813        0.4491  0.922219
## 14            1  7.1421 -2.33562   -0.9775       -6.9816 -1.503578
## 15            1 -1.3375 -2.18039   -0.1631        0.2181  4.299209
##       Fbeta  sim.data ID
## 1    62.598   62.0172  1
## 2  -124.936 -124.1896  2
## 3     4.104    5.1245  3
## 4   -15.946  -15.5475  4
## 5   -27.879  -29.0497  5
## 6    26.618   27.9182  6
## 7    -9.085   -7.1940  7
## 8     1.835    0.7708  8
## 9    36.841   38.5594  9
## 10   -8.951  -10.3705 10
## 11    1.058    1.0528 11
## 12   47.656   45.7029 12
## 13    7.401    8.3237 13
## 14   10.848    9.3446 14
## 15   -5.665   -1.3659 15
</code></pre>

<pre><code class="r">
## Fitting regression to obtain parameter estimates
summary(lm(sim.data ~ 1 + act + diff + numCourse + act:numCourse, data = temp.single))
</code></pre>

<pre><code>## 
## Call:
## lm(formula = sim.data ~ 1 + act + diff + numCourse + act:numCourse, 
##     data = temp.single)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -4.37  -1.09   0.06   1.15   4.99 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     1.9108     0.1510    12.6   &lt;2e-16 ***
## act             4.0243     0.0409    98.4   &lt;2e-16 ***
## diff            1.0040     0.0500    20.1   &lt;2e-16 ***
## numCourse       3.5008     0.0518    67.6   &lt;2e-16 ***
## act:numCourse   1.9974     0.0136   146.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Residual standard error: 1.75 on 145 degrees of freedom
## Multiple R-squared: 0.997,   Adjusted R-squared: 0.997 
## F-statistic: 1.13e+04 on 4 and 145 DF,  p-value: &lt;2e-16
</code></pre>

<h1>Multilevel simulation example</h1>

<h2>Longitudinal Data</h2>

<p>Simulating a multilevel regression model with sim.reg.nested, more specifically longitudinal data with mean centered covariates.  This function outputs the entire design matrix, individual random effects, the error, the cross product, total random effect contribution, simulated data, within cluster ID variable, and cluster level ID variable.</p>

<pre><code class="r">library(simReg)
fixed &lt;- ~1 + time + diff + act + time:act + diff:act
random &lt;- ~1 + time
fixed.param &lt;- c(4, 2, 6, 2.3, 7, 3)
random.param &lt;- c(7, 4)
w.var &lt;- 3
cov.param &lt;- list(c(0, 1.5), c(0, 4))
n &lt;- 50
p &lt;- 6
errorVar &lt;- 4
randCor &lt;- 0
rand.dist &lt;- &quot;norm&quot;
err.dist &lt;- &quot;norm&quot;
serCor &lt;- &quot;ID&quot;
serCorVal &lt;- NULL
data.str &lt;- &quot;long&quot;
head(temp.long &lt;- sim.reg.nested(fixed, random, fixed.param, random.param, w.var, 
    cov.param, n, p, errorVar, randCor, rand.dist, err.dist, serCor, serCorVal, 
    data.str), n = 15)
</code></pre>

<pre><code>##    X.Intercept. time     diff    act time.act diff.act     b0      b1
## 1             1    0 -0.66853  5.197    0.000  -3.4741  5.896 -0.4213
## 2             1    1 -2.04106  5.197    5.197 -10.6066  5.896 -0.4213
## 3             1    2  0.16439  5.197   10.393   0.8543  5.896 -0.4213
## 4             1    3 -0.89396  5.197   15.590  -4.6456  5.896 -0.4213
## 5             1    4 -0.72808  5.197   20.786  -3.7836  5.896 -0.4213
## 6             1    5 -2.76541  5.197   25.983 -14.3707  5.896 -0.4213
## 7             1    0  2.00401  4.421    0.000   8.8595 -1.720  1.4376
## 8             1    1  0.03440  4.421    4.421   0.1521 -1.720  1.4376
## 9             1    2  1.02902  4.421    8.842   4.5492 -1.720  1.4376
## 10            1    3 -0.02535  4.421   13.263  -0.1121 -1.720  1.4376
## 11            1    4  1.08738  4.421   17.683   4.8072 -1.720  1.4376
## 12            1    5  2.77892  4.421   22.104  12.2852 -1.720  1.4376
## 13            1    0 -0.62429 -4.259    0.000   2.6589 -2.109  0.2426
## 14            1    1 -1.35460 -4.259   -4.259   5.7694 -2.109  0.2426
## 15            1    2  2.46178 -4.259   -8.518 -10.4851 -2.109  0.2426
##      Fbeta randEff     err sim.data withinID clustID
## 1    1.519   5.896  2.1647    9.579        1       1
## 2   10.262   5.474 -1.6130   14.124        2       1
## 3   96.254   5.053 -2.5417   98.765        3       1
## 4  111.781   4.632  1.0261  117.438        4       1
## 5  153.738   4.210  0.1084  158.057        5       1
## 6  148.129   3.789 -0.6194  151.299        6       1
## 7   52.771  -1.720  3.9000   54.951        1       2
## 8   47.777  -0.282  0.3758   47.870        2       2
## 9   99.882   1.156 -0.3322  100.705        3       2
## 10 112.518   2.593  0.1536  115.265        4       2
## 11 166.898   4.031  0.6132  171.542        5       2
## 12 232.428   5.468  2.0202  239.916        6       2
## 13  -1.565  -2.109  2.2921   -1.382        1       3
## 14 -24.429  -1.867  2.8482  -23.448        2       3
## 15 -78.108  -1.624 -0.7335  -80.466        3       3
</code></pre>

<pre><code class="r">
## fitting lmer model
library(lme4)
</code></pre>

<pre><code>## Attaching package: &#39;lme4&#39;
</code></pre>

<pre><code>## The following object(s) are masked from &#39;package:stats&#39;:
## 
## AIC, BIC
</code></pre>

<pre><code class="r">lmer(sim.data ~ 1 + time + diff + act + time:act + diff:act + (1 + time | clustID), 
    data = temp.long)
</code></pre>

<pre><code>## Linear mixed model fit by REML 
## Formula: sim.data ~ 1 + time + diff + act + time:act + diff:act + (1 +      time | clustID) 
##    Data: temp.long 
##   AIC  BIC logLik deviance REMLdev
##  1532 1570   -756     1497    1512
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr  
##  clustID  (Intercept) 9.70     3.11           
##           time        2.69     1.64     0.069 
##  Residual             3.38     1.84           
## Number of obs: 300, groups: clustID, 50
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   4.6659     0.4805     9.7
## time          2.0378     0.2410     8.5
## diff          6.0773     0.0872    69.7
## act           2.2982     0.1182    19.4
## time:act      7.0105     0.0593   118.3
## diff:act      3.0134     0.0235   128.3
## 
## Correlation of Fixed Effects:
##          (Intr) time   diff   act    tim:ct
## time     -0.024                            
## diff      0.019 -0.016                     
## act       0.074 -0.002 -0.022              
## time:act -0.001  0.073  0.024 -0.024       
## diff:act -0.023  0.025  0.113 -0.016  0.008
</code></pre>

<h2>Cross Sectional Data</h2>

<pre><code class="r">library(simReg)
fixed &lt;- ~1 + numCourse + act + numCourse:act
random &lt;- ~1
fixed.param &lt;- c(10, 3, 6, 5)
random.param &lt;- c(6)
w.var &lt;- 3
cov.param &lt;- list(c(0, 1.5), c(0, 4))
n &lt;- 60
p &lt;- 18
errorVar &lt;- 4
randCor &lt;- 0
rand.dist &lt;- &quot;norm&quot;
err.dist &lt;- &quot;norm&quot;
serCor &lt;- &quot;ID&quot;
serCorVal &lt;- NULL
data.str &lt;- &quot;cross&quot;
head(temp.cross &lt;- sim.reg.nested(fixed, random, fixed.param, random.param, 
    w.var, cov.param, n, p, errorVar, randCor, rand.dist, err.dist, serCor, 
    serCorVal, data.str), n = 15)
</code></pre>

<pre><code>##    X.Intercept. numCourse      act numCourse.act      b0   Fbeta randEff
## 1             1   1.61246 -2.24281      -3.61645 -0.7486 -16.702 -0.7486
## 2             1  -1.40787  1.78420      -2.51193 -0.7486   3.922 -0.7486
## 3             1  -0.31416 -1.30326       0.40944 -0.7486   3.285 -0.7486
## 4             1  -2.08525 -3.38432       7.05718 -0.7486  18.724 -0.7486
## 5             1   0.99967  0.88940       0.88910 -0.7486  22.781 -0.7486
## 6             1   1.45030  4.81778       6.98722 -0.7486  78.194 -0.7486
## 7             1   0.94972  0.06662       0.06327 -0.7486  13.565 -0.7486
## 8             1   0.57500 -3.13462      -1.80242 -0.7486 -16.095 -0.7486
## 9             1  -0.04344 -2.20666       0.09586 -0.7486  -2.891 -0.7486
## 10            1   1.39059  2.84460       3.95567 -0.7486  51.018 -0.7486
## 11            1  -1.52788 10.39712     -15.88552 -0.7486 -11.629 -0.7486
## 12            1  -0.89870  3.79391      -3.40960 -0.7486  13.019 -0.7486
## 13            1  -0.17503 -0.26877       0.04704 -0.7486   8.097 -0.7486
## 14            1  -2.65311 -0.45324       1.20249 -0.7486   5.334 -0.7486
## 15            1  -0.28512  1.57457      -0.44894 -0.7486  16.347 -0.7486
##        err sim.data withinID clustID
## 1  -0.6876  -18.138        1       1
## 2  -0.1960    2.977        2       1
## 3   4.3346    6.871        3       1
## 4   1.3863   19.362        4       1
## 5   1.2053   23.238        5       1
## 6  -1.1458   76.299        6       1
## 7   1.8476   14.664        7       1
## 8  -2.2046  -19.048        8       1
## 9  -1.0906   -4.730        9       1
## 10  0.6899   50.959       10       1
## 11  0.8863  -11.491       11       1
## 12  0.5747   12.845       12       1
## 13  2.3566    9.705       13       1
## 14 -0.0887    4.496       14       1
## 15  1.3382   16.937       15       1
</code></pre>

<pre><code class="r">
## fitting lmer model
library(lme4)
lmer(sim.data ~ 1 + numCourse + act + numCourse:act + (1 | clustID), data = temp.cross)
</code></pre>

<pre><code>## Linear mixed model fit by REML 
## Formula: sim.data ~ 1 + numCourse + act + numCourse:act + (1 | clustID) 
##    Data: temp.cross 
##   AIC  BIC logLik deviance REMLdev
##  4760 4790  -2374     4729    4748
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  clustID  (Intercept) 6.98     2.64    
##  Residual             3.86     1.96    
## Number of obs: 1080, groups: clustID, 60
## 
## Fixed effects:
##               Estimate Std. Error t value
## (Intercept)    10.1435     0.3463      29
## numCourse       3.0282     0.0416      73
## act             6.0032     0.0158     380
## numCourse:act   4.9833     0.0111     450
## 
## Correlation of Fixed Effects:
##             (Intr) numCrs act   
## numCourse   -0.001              
## act         -0.006  0.006       
## numCours:ct  0.001  0.012  0.021
</code></pre>

<h1>Using sim.reg</h1>

<h2>Single Level</h2>

<pre><code class="r">library(simReg)
fixed &lt;- ~1 + act + diff + numCourse + act:numCourse
fixed.param &lt;- c(2, 4, 1, 3.5, 2)
cov.param &lt;- list(c(0, 4), c(0, 3), c(0, 3))
n &lt;- 150
errorVar &lt;- 3
err.dist &lt;- &quot;norm&quot;
head(temp.single &lt;- sim.reg(fixed, fixed.param, cov.param, n, errorVar, err.dist, 
    data.str = &quot;single&quot;), n = 15)
</code></pre>

<pre><code>## Error: error in evaluating the argument &#39;x&#39; in selecting a method for
## function &#39;head&#39;: Error in sim.reg.single(fixed, fixed.param, cov.param, n,
## errorVar, err.dist) : Fixed lengths not equal Calls: sim.reg -&gt;
## sim.reg.single
</code></pre>

<pre><code class="r">
## Fitting regression to obtain parameter estimates
summary(lm(sim.data ~ 1 + act + diff + numCourse + act:numCourse, data = temp.single))
</code></pre>

<pre><code>## 
## Call:
## lm(formula = sim.data ~ 1 + act + diff + numCourse + act:numCourse, 
##     data = temp.single)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
##  -4.37  -1.09   0.06   1.15   4.99 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     1.9108     0.1510    12.6   &lt;2e-16 ***
## act             4.0243     0.0409    98.4   &lt;2e-16 ***
## diff            1.0040     0.0500    20.1   &lt;2e-16 ***
## numCourse       3.5008     0.0518    67.6   &lt;2e-16 ***
## act:numCourse   1.9974     0.0136   146.9   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 
## 
## Residual standard error: 1.75 on 145 degrees of freedom
## Multiple R-squared: 0.997,   Adjusted R-squared: 0.997 
## F-statistic: 1.13e+04 on 4 and 145 DF,  p-value: &lt;2e-16
</code></pre>

<pre><code class="r">library(simReg)
fixed &lt;- ~1 + time + diff + act + time:act
random &lt;- ~1 + time + diff
fixed.param &lt;- c(4, 2, 6, 2.3, 7)
random.param &lt;- c(7, 4, 2)
w.var &lt;- 3
cov.param &lt;- list(c(0, 1.5), c(0, 4))
n &lt;- 150
p &lt;- 30
errorVar &lt;- 4
randCor &lt;- 0
rand.dist &lt;- &quot;norm&quot;
err.dist &lt;- &quot;norm&quot;
serCor &lt;- &quot;ID&quot;
serCorVal &lt;- NULL
data.str &lt;- &quot;long&quot;
head(temp.long &lt;- sim.reg(fixed, random, fixed.param, random.param, w.var, cov.param, 
    n, p, errorVar, randCor, rand.dist, err.dist, serCor, serCorVal, data.str), 
    n = 15)
</code></pre>

<pre><code>##    X.Intercept. time     diff      act time.act    b0     b1    b2  Fbeta
## 1             1    0  2.26559 -0.06539  0.00000 2.154 -1.258 1.811 17.443
## 2             1    1 -0.04865 -0.06539 -0.06539 2.154 -1.258 1.811  5.100
## 3             1    2  0.23733 -0.06539 -0.13078 2.154 -1.258 1.811  8.358
## 4             1    3  0.18984 -0.06539 -0.19617 2.154 -1.258 1.811  9.615
## 5             1    4  0.71446 -0.06539 -0.26156 2.154 -1.258 1.811 14.305
## 6             1    5  0.96050 -0.06539 -0.32695 2.154 -1.258 1.811 17.324
## 7             1    6  2.49242 -0.06539 -0.39234 2.154 -1.258 1.811 28.058
## 8             1    7 -0.81884 -0.06539 -0.45772 2.154 -1.258 1.811  9.732
## 9             1    8  1.01361 -0.06539 -0.52311 2.154 -1.258 1.811 22.269
## 10            1    9 -1.90435 -0.06539 -0.58850 2.154 -1.258 1.811  6.304
## 11            1   10 -0.15178 -0.06539 -0.65389 2.154 -1.258 1.811 18.362
## 12            1   11  2.37212 -0.06539 -0.71928 2.154 -1.258 1.811 35.047
## 13            1   12  1.16961 -0.06539 -0.78467 2.154 -1.258 1.811 29.375
## 14            1   13 -4.25133 -0.06539 -0.85006 2.154 -1.258 1.811 -1.609
## 15            1   14 -0.78693 -0.06539 -0.91545 2.154 -1.258 1.811 20.720
##      randEff     err sim.data withinID clustID
## 1    6.25749  2.0711   25.772        1       1
## 2    0.80765 -1.2485    4.659        2       1
## 3    0.06794  0.1816    8.608        3       1
## 4   -1.27583 -0.7627    7.577        4       1
## 5   -1.58325  1.2471   13.969        5       1
## 6   -2.39531  0.3348   15.263        6       1
## 7   -0.87805 -0.5779   26.602        7       1
## 8   -8.13396 -0.1116    1.487        8       1
## 9   -6.07231  0.4499   16.647        9       1
## 10 -12.61578  0.5315   -5.780       10       1
## 11 -10.69883  3.7274   11.390       11       1
## 12  -7.38466  3.0859   30.749       12       1
## 13 -10.82068 -1.3557   17.198       13       1
## 14 -21.89817  1.4536  -22.053       14       1
## 15 -16.88034 -0.8959    2.944       15       1
</code></pre>

<pre><code class="r">
## fitting lmer model
library(lme4)
lmer(sim.data ~ 1 + time + diff + act + time:act + (1 + time + diff | clustID), 
    data = temp.long)
</code></pre>

<pre><code>## Linear mixed model fit by REML 
## Formula: sim.data ~ 1 + time + diff + act + time:act + (1 + time + diff |      clustID) 
##    Data: temp.long 
##    AIC   BIC logLik deviance REMLdev
##  21206 21283 -10591    21169   21182
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr          
##  clustID  (Intercept) 7.23     2.69                   
##           time        3.83     1.96      0.015        
##           diff        2.14     1.46     -0.088  0.032 
##  Residual             3.88     1.97                   
## Number of obs: 4500, groups: clustID, 150
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   4.1798     0.2273    18.4
## time          1.9091     0.1600    11.9
## diff          6.0264     0.1214    49.6
## act           2.3144     0.0604    38.3
## time:act      6.9877     0.0426   164.0
## 
## Correlation of Fixed Effects:
##          (Intr) time   diff   act   
## time      0.009                     
## diff     -0.084  0.031              
## act       0.035  0.000  0.000       
## time:act  0.000  0.035  0.000  0.012
</code></pre>

</body>

</html>

